<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>utils.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="CodeListsSpecification.html">CodeListsSpecification</a><ul class='methods'><li data-type='method'><a href="CodeListsSpecification.html#postProcessData">postProcessData</a></li></ul></li><li><a href="CTASSpecification.html">CTASSpecification</a></li><li><a href="Definition.html">Definition</a></li><li><a href="IEPDSpecification.html">IEPDSpecification</a><ul class='methods'><li data-type='method'><a href="IEPDSpecification.html#postProcessData">postProcessData</a></li></ul></li><li><a href="JSONSpecification.html">JSONSpecification</a></li><li><a href="NDRSpecification.html">NDRSpecification</a><ul class='methods'><li data-type='method'><a href="NDRSpecification.html#postProcessData">postProcessData</a></li><li data-type='method'><a href="NDRSpecification.html#preProcessHTML">preProcessHTML</a></li></ul></li><li><a href="NIEMSpecifications.html">NIEMSpecifications</a><ul class='methods'><li data-type='method'><a href="NIEMSpecifications.html#.parse">parse</a></li><li data-type='method'><a href="NIEMSpecifications.html#.parse">parse</a></li><li data-type='method'><a href="NIEMSpecifications.html#load">load</a></li><li data-type='method'><a href="NIEMSpecifications.html#load">load</a></li><li data-type='method'><a href="NIEMSpecifications.html#loadSpecificationClassMetadata">loadSpecificationClassMetadata</a></li><li data-type='method'><a href="NIEMSpecifications.html#loadSpecificationClassMetadata">loadSpecificationClassMetadata</a></li><li data-type='method'><a href="NIEMSpecifications.html#loadSpecificationMetadata">loadSpecificationMetadata</a></li><li data-type='method'><a href="NIEMSpecifications.html#loadSpecificationMetadata">loadSpecificationMetadata</a></li><li data-type='method'><a href="NIEMSpecifications.html#save">save</a></li><li data-type='method'><a href="NIEMSpecifications.html#save">save</a></li><li data-type='method'><a href="NIEMSpecifications.html#specification">specification</a></li><li data-type='method'><a href="NIEMSpecifications.html#specification">specification</a></li><li data-type='method'><a href="NIEMSpecifications.html#specificationClass">specificationClass</a></li><li data-type='method'><a href="NIEMSpecifications.html#specificationClass">specificationClass</a></li></ul></li><li></li><li><a href="Parser.html">Parser</a><ul class='methods'><li data-type='method'><a href="Parser.html#.parseSpecification">parseSpecification</a></li><li data-type='method'><a href="Parser.html#appendTextFollowup">appendTextFollowup</a></li><li data-type='method'><a href="Parser.html#parseDefinitions">parseDefinitions</a></li><li data-type='method'><a href="Parser.html#parseDefinitionTerm">parseDefinitionTerm</a></li><li data-type='method'><a href="Parser.html#parseHTML">parseHTML</a></li><li data-type='method'><a href="Parser.html#parseRuleClassification">parseRuleClassification</a></li><li data-type='method'><a href="Parser.html#parseRuleDescription">parseRuleDescription</a></li><li data-type='method'><a href="Parser.html#parseRuleHeading">parseRuleHeading</a></li><li data-type='method'><a href="Parser.html#parseRuleLabel">parseRuleLabel</a></li><li data-type='method'><a href="Parser.html#parseRules">parseRules</a></li><li data-type='method'><a href="Parser.html#parseRuleTargets">parseRuleTargets</a></li><li data-type='method'><a href="Parser.html#parseSection">parseSection</a></li><li data-type='method'><a href="Parser.html#preProcessHTML">preProcessHTML</a></li></ul></li><li><a href="Rule.html">Rule</a></li><li><a href="Section.html">Section</a></li><li><a href="Specification.html">Specification</a><ul class='methods'><li data-type='method'><a href="Specification.html#postProcessData">postProcessData</a></li><li data-type='method'><a href="Specification.html#preProcessHTML">preProcessHTML</a></li><li data-type='method'><a href="Specification.html#save">save</a></li></ul></li><li><a href="SpecificationClass.html">SpecificationClass</a><ul class='methods'><li data-type='method'><a href="SpecificationClass.html#save">save</a></li><li data-type='method'><a href="SpecificationClass.html#version">version</a></li></ul></li><li><a href="Utils.html">Utils</a><ul class='methods'><li data-type='method'><a href="Utils.html#.flatten">flatten</a></li><li data-type='method'><a href="Utils.html#.nameFile">nameFile</a></li><li data-type='method'><a href="Utils.html#.nameFileAndSave">nameFileAndSave</a></li><li data-type='method'><a href="Utils.html#.readSpecificationHTMLText">readSpecificationHTMLText</a></li><li data-type='method'><a href="Utils.html#.readYAML">readYAML</a></li><li data-type='method'><a href="Utils.html#.save">save</a></li><li data-type='method'><a href="Utils.html#.trash">trash</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">utils.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
let fs = require("fs-extra");
let json2csv = require("json2csv");
let path = require("path");
let trash = require("trash");
let xmlConverter = require("xml-js");
let yaml = require("yamljs");

/**
 * General utility functions to support the project.
 */
class Utils {

  /**
   * Flattens an array of arrays
   * @template T
   * @param {T[][]} arrays - An array of arrays
   * @returns {T[]}
   */
  static flatten(arrays) {
    return [].concat.apply([], arrays);
  }

  /**
   * Saves given data as JSON and YAML to the default or given output directory.
   * Also constructs the file name from the given fields.
   *
   * @param {"all"|"class"|"spec"} scope
   * @param {"rules"|"defs"|"classes"|"specs"} style
   * @param {"NDR"|"IEPD"|"MPD"|"CodeLists"|"CTAS"} label - Specification class ID or tag
   * @param {String} version
   */
  static nameFile(scope, style, label, version) {

    if (scope == "all") {
      style = style.replace("classes", "spec-classes");
      return `niem-${style}`.toLowerCase();
    }
    else if (scope == "class") {
      return `${label.replace("MPD", "IEPD")}-${style}`.toLowerCase();
    }
    else if (scope == "spec") {
      return `${label}-${style}-${version}`.toLowerCase();
    }

    console.log("Given scope not supported:", scope);
    return;

  }

  /**
   * Saves given data as JSON and YAML to the default or given output directory.
   * Also constructs the file name from the given fields.
   *
   * @param {"all"|"class"|"spec"} scope
   * @param {"rules"|"defs"|"classes"|"specs"} style
   * @param {"NDR"|"IEPD"|"MPD"|"CodeLists"|"CTAS"} label - Specification class ID or tag
   * @param {String} version
   */
  static nameFileAndSave(scope, style, label, version, data, folder="./output/") {
    let fileName = Utils.nameFile(scope, style, label, version);
    return Utils.save(fileName, data, folder, style);
  }

  /**
   * Reads the specification html file in the specifications directory with the given tag and version
   */
  static readSpecificationHTMLText(tag, version) {
    let html = fs.readFileSync(`specifications/${tag}-${version}.html`, {encoding: "utf8"});
    return html;
  }

  /**
   * Reads in a YAML file at the given path and returns the data as an object.
   *
   * @param {String} filePath
   * @returns {Object}
   */
  static readYAML(filePath) {
    let normalizedPath = path.join(__dirname, filePath);
    let text = fs.readFileSync(normalizedPath, "utf-8");
    return yaml.parse(text);
  }

  /**
   * Saves given data as JSON and YAML to the default or given output directory.
   *
   * @param {String} fileName - Base file name, no extension or path
   * @param {Object} data - Data to save
   * @param {String} [folder='./output/'] - Folder to save output files.  Defaults to /output.
   * @param {"rules"|"defs"|"classes"|"specs"} style - Used to generate additional XML tags to wrap the data
   */
  static save(fileName, data, folder="./output/", style) {

    let originalJSON = JSON.stringify(data);
    let convertedData = JSON.parse(originalJSON);

    // Create custom subfolders for each export format
    let subfolder = (extension) => path.join(folder, extension, fileName.toLowerCase() + "." + extension);

    // Save JSON
    fs.outputJSONSync( subfolder("json"), data, {spaces: 2} );

    // Save YAML (library isn't calling toJSON on stringify so do it manually)
    fs.outputFileSync( subfolder("yaml"), yaml.stringify(convertedData) );

    // Save XML
    let xmlData = convertObjectToXML(data, style);
    fs.outputFileSync( subfolder("xml"), xmlData );

    // Save CSV
    let csvData = json2csv.parse(convertedData);
    fs.outputFileSync( subfolder("csv"), csvData );

  }

  /**
   * Sends files in the given folder to the OS-specific recycle bin.
   */
  static async trash(folder) {
    let normalizedPath = path.resolve(__dirname, folder);
    return trash(normalizedPath);
  }

}

/**
 * Converts an array of objects to an XML string.
 * Wraps the array with a root element and adds tags for each element of the array.
 *
 * @private
 * @param {Array&lt;Object>} dataArray
 * @param {String} rootTag - Word (plural form) to use as the root tag for the XML document
 */
function convertObjectToXML(dataArray, rootTag) {

  let xmlObject = {};

  // Adjust tag name
  if (rootTag == "classes") rootTag = "specificationClasses";
  if (rootTag == "specs" ) rootTag = "specifications";
  if (rootTag == "defs") rootTag = "definitions";

  // Root-level tag for the XML
  xmlObject[rootTag] = {};

  // Generate a tag name to use for the anonymous array elements
  let elementTag = rootTag.replace(/s$/, "").replace(/Classe$/, "Class");
  xmlObject[rootTag][elementTag] = dataArray;

  // Convert XML-formatted object to an XML string
  let json = JSON.stringify(xmlObject);
  let xmlText = xmlConverter.json2xml(json, {compact: true, spaces: 2});

  return `&lt;?xml version="1.0" encoding="UTF-8"?>\n` + xmlText;

}

module.exports = Utils;
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
